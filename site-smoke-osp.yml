---
- name: smoke test
  hosts: localhost
  connection: local
  gather_facts: false
  roles:
    - osp-facts

- name: testing frontend
  hosts: frontend
  gather_facts: true
  tasks:
    - name: Curl website
      uri:
        url: "http://{{ ansible_host }}/ping"
        return_content: yes
        status_code: 200
      register: webpage
      delegate_to: localhost

    - name: Fail if 'Ping!' is not in the page content
      fail:
      when: "'Ping!' not in webpage.content"
      tags:
        - osp.smoke
